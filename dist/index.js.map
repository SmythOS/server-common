{"version":3,"file":"index.js","sources":["../src/APIError.class.ts","../src/constants.ts","../src/middlewares/AgentLoader.mw.ts","../src/middlewares/CORS.mw.ts","../src/middlewares/RemoveHeadersFactory.mw.ts","../src/middlewares/UploadHandlerFactory.mw.ts","../src/roles/Base.role.ts","../src/utils/agent.utils.ts","../src/roles/agent/AgentRequestHandler.ts","../src/roles/agent/Agent.role.ts","../src/roles/alexa/Alexa.service.ts","../src/roles/alexa/Alexa.role.ts","../src/roles/chatgpt/ChatGPT.role.ts","../src/roles/mcp/MCP.service.ts","../src/roles/mcp/MCP.role.ts","../src/roles/openai/Chat.service.ts","../src/roles/openai/chat.validation.ts","../src/roles/openai/middlewares/AgentDataAdapter.mw.ts","../src/roles/openai/middlewares/Validate.mw.ts","../src/roles/openai/utils.ts","../src/roles/openai/OpenAI.role.ts","../src/roles/openapi/OpenAPI.role.ts","../src/roles/postman/Postman.role.ts","../src/roles/swagger/Swagger.role.ts"],"sourcesContent":["/**\n * @class ApiError\n * @extends Error\n * @public\n * @description\n * ApiError class is used to create an error object that will be used by the error handler middleware.\n * It is the primary error class that will be used in the application.\n\n */\nclass ApiError extends Error {\n    statusCode: number | null | undefined;\n\n    isOperational: boolean;\n\n    stack: string | undefined;\n\n    errKey: string | undefined;\n\n    isApiError: boolean;\n\n    /**\n     *\n     * @param statusCode - http status code of the error\n     * @param message - error message\n     * @param isOperational - whether the error should be shown in production or not (if not, internal server error will be shown)\n     * @param stack - error stack trace\n     * @param errKey -  error code to be used in the response\n     */\n    constructor(statusCode: number | null | undefined, message: string, errKey?: string, isOperational = true, stack?: string) {\n        super(message);\n        this.statusCode = statusCode;\n        this.isOperational = isOperational === undefined ? true : isOperational;\n        this.errKey = errKey;\n        this.isApiError = true;\n    }\n}\n\nexport default ApiError;\n","// the key in the agent settings object that contains the model name\nexport const DEFAULT_AGENT_MODEL_SETTINGS_KEY = 'chatGptModel';\n\n// the default model to use if no model is specified in the agent settings\nexport const DEFAULT_AGENT_MODEL = 'gpt-4o-mini';\n","import { AgentSettings, ConnectorService, Logger } from '@smythos/sdk/core';\n\nconst console = Logger('AgentLoader.mw');\n\nexport default async function AgentLoader(req, res, next) {\n    console.log('AgentLoader', req.path);\n    const agentDataConnector = ConnectorService.getAgentDataConnector();\n\n    let agentId = req.header('X-AGENT-ID');\n    const agentVersion = req.header('X-AGENT-VERSION') || '';\n    const debugHeader =\n        req.header('X-DEBUG-STOP') !== undefined ||\n        req.header('X-DEBUG-RUN') !== undefined ||\n        req.header('X-DEBUG-INJ') !== undefined ||\n        req.header('X-DEBUG-READ') !== undefined;\n\n    let agentDomain: string = '';\n    let isTestDomain = false;\n    const { path, version: extractedVersion } = extractAgentVerionsAndPath(req.path);\n    let version = extractedVersion ?? agentVersion;\n\n    const domain = req.hostname;\n    const method = req.method;\n    if (!agentId) {\n        agentId = await agentDataConnector.getAgentIdByDomain(domain).catch((error) => {\n            console.error(error);\n        });\n        agentDomain = domain; //only override agentDomain if the agentId was loaded from domain\n    }\n    if (agentId && domain.includes(process.env.AGENT_DOMAIN)) {\n        isTestDomain = true;\n    }\n\n    if (agentId) {\n        if (!isTestDomain && agentId && req.hostname.includes('localhost')) {\n            console.log(`Agent is running on localhost (${req.hostname}), assuming test domain`);\n            isTestDomain = true;\n        }\n        if (agentDomain && !isTestDomain && !version && !debugHeader) {\n            //when using a production domain but no version is specified, use latest\n            version = 'latest';\n        }\n        const agentData = await agentDataConnector.getAgentData(agentId, version).catch((error) => {\n            console.warn('Failed to load agent data', {\n                agentId,\n                version,\n                errorMessage: error?.message,\n            });\n            return { error: error.message };\n        });\n        if (agentData?.error) {\n            // return Not found error for storage requests\n            if (req.path.startsWith('/storage/')) {\n                return res.status(404).send(`File Not Found`);\n            }\n            return res.status(500).send({ error: agentData.error });\n        }\n\n        // clean up agent data\n        cleanAgentData(agentData);\n\n        req._plan = agentData.data.planInfo;\n        req._agentData = agentData.data;\n        req._agentData.planInfo = req._plan || {\n            planId: undefined,\n            planName: undefined,\n            isFreePlan: true,\n            tasksQuota: 0,\n            usedTasks: 0,\n            remainingTasks: 0,\n            maxLatency: 100,\n        };\n\n        if (!isTestDomain && req._agentData.debugSessionEnabled && debugHeader) {\n            console.log(`Host ${req.hostname} is using debug session. Assuming test domain.#2`);\n            isTestDomain = true;\n        }\n\n        req._agentData.usingTestDomain = isTestDomain;\n        req._agentData.domain = agentDomain || agentData?.data?.metadata?.domains?.[0]?.name || (await getAgentDomainById(agentId));\n        req._agentVersion = version;\n        req._agentData.version = version; //normally agentData.version stores the schema version, but for some backwards compatibility reasons, we override it with the actual agent version.\n        const agentSettings = new AgentSettings(agentId);\n        req._agentSettings = agentSettings;\n\n        console.log(`Loaded Agent:${agentId} v=${version} path=${path} isTestDomain=${isTestDomain} domain=${agentDomain}`);\n        return next();\n    }\n\n    console.warn('Not found', { path: req.path });\n    return res.status(404).send({ error: `${req.path} Not Found` });\n}\n// clean up agent data\nfunction cleanAgentData(agentData) {\n    if (agentData) {\n        // remove Note components\n        if (agentData.data.components) {\n            agentData.data.components = agentData.data.components?.filter((c) => c.name != 'Note');\n        }\n\n        // remove templateInfo\n        delete agentData.data?.templateInfo;\n\n        // TODO : remove UI attributes\n    }\n    return agentData;\n}\n\nexport function extractAgentVerionsAndPath(url) {\n    const regex = /^\\/v(\\d+(\\.\\d+)?)?(\\/api\\/.+)/;\n    const match = url.match(regex);\n\n    if (match) {\n        return {\n            path: match[3],\n            version: match[1] || '',\n        };\n    } else {\n        return {\n            path: url,\n            version: '',\n        };\n    }\n}\n\nexport async function getAgentDomainById(agentId: string) {\n    const agentDataConnector = ConnectorService.getAgentDataConnector();\n\n    const deployed = await agentDataConnector.isDeployed(agentId);\n    if (deployed) {\n        return `${agentId}.${process.env.PROD_AGENT_DOMAIN}`;\n    } else {\n        return `${agentId}.${process.env.AGENT_DOMAIN}`;\n    }\n}\n","import cors from 'cors';\n\nimport { Agent, AgentSettings, Logger } from '@smythos/sdk/core';\nconst console = Logger('CORS.mw');\n\nasync function getEmbodimentsAllowedOrigins(agentSettings: AgentSettings) {\n    // wait for agent embodiments to be ready\n    await agentSettings?.embodiments?.ready();\n\n    const embSettings = agentSettings?.embodiments?.getAll() ?? {};\n    const agentAllowedOrigins = Object.values(embSettings)\n        .flatMap((embodiment: any) => embodiment.allowedDomains)\n        .flat(Infinity)\n        .map((domain: string) => {\n            if (domain?.startsWith('http')) {\n                return new URL(domain)?.origin;\n            }\n            return `https://${domain}`;\n        });\n    return agentAllowedOrigins;\n}\n\nfunction checkCors(req: any, allowedOrigins: string[], allowedDomains: string[]) {\n    const origin = req.get('Origin'); //origin is the origin of the request\n\n    if (!origin) return true;\n    const host = req.get('Host'); //host is the host of the request\n    const originDomain = new URL(origin).hostname;\n\n    console.log('Cors check ', origin, '==>', host);\n\n    //first check if the origin is the same as the host\n    const isSameOrigin = origin === `http://${host}` || origin === `https://${host}`;\n    if (isSameOrigin) return true;\n\n    //then check if the origin is in the allowed origins\n    if (allowedOrigins.includes(origin)) return true;\n\n    //then check if the origin domain is in the allowed domains\n    if (allowedDomains.includes(originDomain)) return true;\n\n    if (req.method == 'OPTIONS') {\n        console.log('CORS check ', { path: req.path, host, origin }, '==> Denied ');\n        console.log('Allowed Domains for this request ', allowedOrigins, allowedDomains);\n    }\n\n    return false;\n}\n\n// Custom CORS middleware\n//FIXME : make default CORS configurable from .env file\nconst corsOptionsDelegate = async (req, callback) => {\n    const allowedEmbOrigins = await getEmbodimentsAllowedOrigins(req._agentSettings);\n    const isAllowed = checkCors(req, allowedEmbOrigins, []);\n    let corsOptions;\n    if (isAllowed) {\n        // Enable CORS for the same origin and the allowed domains\n        corsOptions = {\n            origin: true,\n            credentials: true, // Allow credentials (cookies, etc.)\n            methods: ['GET', 'POST', 'PUT', 'DELETE'], // Allowed methods\n            allowedHeaders: ['Content-Type', 'Authorization', 'X-Conversation-Id', 'X-Auth-Token', 'X-Parent-Cookie'],\n        };\n    } else {\n        // Disable CORS for other requests\n        corsOptions = { origin: false };\n    }\n\n    callback(null, corsOptions);\n};\n\nconst middleware = cors(corsOptionsDelegate);\n\nexport default middleware;\n","//This middleware is used on agent servers because they are not supposed to handle debug requests\n\nexport default function RemoveHeadersFactory(headers: string[]) {\n    return (req, res, next) => {\n        headers.forEach((header) => {\n            if (req.headers[header]) {\n                delete req.headers[header];\n            }\n        });\n        return next();\n    };\n}\n","import multer from 'multer';\nimport { Logger } from '@smythos/sdk/core';\nconst console = Logger('UploadHandlerFactory.mw');\n\nconst MAX_FILE_SIZE = 1024 * 1024 * 20; // 20MB\nconst MAX_FILE_COUNT = 5;\n\nexport default function uploadHandlerFactory(maxFileSize: number = MAX_FILE_SIZE, maxFileCount: number = MAX_FILE_COUNT) {\n    const upload = multer({\n        limits: { fileSize: maxFileSize },\n        storage: multer.memoryStorage(),\n    });\n\n    function uploadHandler(req, res, next) {\n        upload.any()(req, res, (err) => {\n            if (err) {\n                console.warn(`File upload error: ${err.message}`);\n                return next(new Error(`File upload error: ${err.message}`));\n            }\n\n            if (req.files && req.files.length > maxFileCount) {\n                console.warn(`Too many files: ${req.files.length}`);\n                return res.status(400).send('Too many files');\n            }\n\n            next();\n        });\n    }\n\n    return uploadHandler;\n}\n","import express from 'express';\n\n/**\n * Generic type for values that can be either static or dynamically resolved via a function.\n * @template T - The type of the resolved value\n * @template Args - The argument object type for the resolver function\n *\n * @example\n * type ModelResolver = Resolvable<string, { baseModel: string; planInfo: Record<string, any> }>;\n * type ServerOriginResolver = Resolvable<string, { req: express.Request }>;\n */\nexport type Resolvable<T, Args = void> = T | ((args: Args) => T);\n\nexport class BaseRole {\n    /**\n     * Creates a new Role instance.\n     * @param router - The router to mount the role on.\n     * @param middlewares - The custom middlewares to apply to the role on top of the default middlewares.\n     */\n    constructor(\n        protected middlewares: express.RequestHandler[],\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        protected options?: Record<string, any>,\n    ) {}\n\n    /**\n     * Resolves a value that can be either static or dynamically computed via a function.\n     * This generic method implements the DRY principle for value-or-function resolution patterns.\n     *\n     * @template T - The type of the resolved value\n     * @template Args - The argument object type for the resolver function\n     *\n     * @param resolvable - Either a static value of type T or a function that returns T\n     * @param args - Optional argument object to pass to the resolver function (required only if resolvable is a function)\n     * @param defaultValue - Optional default value to use if resolvable is undefined or returns undefined\n     * @returns The resolved value of type T, or defaultValue, or undefined\n     *\n     * @example\n     * -- Resolve static value with default\n     * const timeout = this.resolve(this.options.timeout, undefined, 5000);\n     *\n     * @example\n     * -- Resolve dynamic value without default (returns string | undefined)\n     * const origin = this.resolve(this.options.serverOrigin, req);\n     *\n     * @example\n     * -- Resolve model with default fallback (always returns string)\n     * const model = this.resolve(\n     *     this.options.model,\n     *     { baseModel, planInfo: agentData?.planInfo || {} },\n     *     baseModel\n     * );\n     */\n    protected resolve<T, Args = void>(resolvable: Resolvable<T, Args> | undefined, args?: Args, defaultValue?: T): T | undefined {\n        if (resolvable === undefined) {\n            return defaultValue;\n        }\n        const resolved = typeof resolvable === 'function' ? (resolvable as (args: Args) => T)(args!) : resolvable;\n        return resolved !== undefined ? resolved : defaultValue;\n    }\n\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    public async mount(router: express.Router) {}\n}\n","const PROD_VERSION_VALUES = ['prod', 'production', 'stable'];\nconst TEST_VERSION_VALUES = ['dev', 'develop', 'development', 'test', 'staging'];\n\nexport function getAgentIdAndVersion(model: string) {\n    const [agentId, version] = model.split('@');\n    let agentVersion = version?.trim() || undefined;\n    if (TEST_VERSION_VALUES.includes(agentVersion)) {\n        agentVersion = '';\n    }\n    if (PROD_VERSION_VALUES.includes(agentVersion)) {\n        agentVersion = 'latest';\n    }\n\n    return { agentId, agentVersion };\n}\n","import { Request, Response } from 'express';\nimport axios from 'axios';\nimport { AccessCandidate, ConnectorService, AgentProcess, Logger } from '@smythos/sdk/core';\n\nconst console = Logger('AgentRequestHandler');\n\nconst debugPromises: any = {}; //TODO : persist this ?\nexport const sseConnections = new Map();\n\nconst MOCK_DATA = {\n    SETTINGS_KEY: 'agent-mock-data',\n} as const;\n// TODO: apply cache\nexport async function getMockData(agentId: string) {\n    const accountConnector = ConnectorService.getAccountConnector();\n    const mockData = await accountConnector.user(AccessCandidate.agent(agentId)).getAgentSetting(MOCK_DATA.SETTINGS_KEY);\n    return JSON.parse(mockData || '{}');\n}\n\nexport function getDebugSession(id) {\n    console.log(`Getting debug session for agent ${id} with session id ${debugPromises[id]?.dbgSession}`);\n    console.log(`Session exists: ${debugPromises[id] ? 'Yes' : 'No'} and session.dbgSession exists: ${debugPromises[id]?.dbgSession ? 'Yes' : 'No'}`);\n    console.log(`Debug sessions found for the following agents: ${Object.keys(debugPromises).join(', ')}`);\n    return debugPromises[id]?.dbgSession;\n}\n\nexport function createSseConnection(req: any) {\n    const sseId = Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15);\n    const INACTIVITY_TIMEOUT = 60 * 60 * 1000; // 1 hour\n    const res = req.res;\n    const connection = { res, timeout: null };\n    // Store the connection\n    sseConnections.set(sseId, connection);\n    console.log(`Created SSE connection for ${sseId}`);\n\n    const originalWrite = res.write;\n\n    res.write = function (...args) {\n        // Reset the inactivity timeout\n        clearTimeout(connection.timeout);\n        connection.timeout = setTimeout(() => {\n            console.log(`Client disconnected: ${sseId}`);\n            sseConnections.delete(sseId);\n            res.end();\n        }, INACTIVITY_TIMEOUT);\n\n        // Call the original res.write\n        return originalWrite.apply(res, args);\n    };\n\n    // Clean up when the client disconnects\n    req.on('close', () => {\n        console.log(`Client disconnected: ${sseId}`);\n        sseConnections.delete(sseId);\n        res.end();\n    });\n\n    return sseId;\n}\n\nfunction handleMonitorIds(req: any, agentProcess: AgentProcess) {\n    const monitorIds = req.header('X-MONITOR-ID')\n        ? new Set<string>(\n              req\n                  .header('X-MONITOR-ID')\n                  .split(',')\n                  .map((id: string) => id.trim()),\n          )\n        : undefined;\n    if (monitorIds) {\n        for (const monitorId of monitorIds) {\n            if (sseConnections.has(monitorId)) {\n                const connection = sseConnections.get(monitorId);\n                agentProcess.agent.addSSE(connection.res, monitorId);\n            }\n        }\n    }\n}\n\n/**\n * Read the last agent debug state from the current agent context\n * @param req\n * @param agentProcess\n * @param readStateId\n * @returns\n */\nasync function readAgentState(req: any, agentProcess: AgentProcess, readStateId: string) {\n    try {\n        const result = await agentProcess.readDebugState(readStateId, {\n            ...req,\n            path: req.url,\n            url: undefined,\n            headers: {\n                ...req.headers,\n            },\n        });\n        return { status: 200, data: result };\n    } catch (error: any) {\n        console.error(error);\n        return { status: 400, data: 'Agent State Unavailable' };\n    }\n}\n\nasync function handleMockData(req: any, agentProcess: AgentProcess) {\n    const agentData = req?._agentData;\n    const agentId = agentData?.id;\n    let body = [];\n\n    try {\n        const mockData = await getMockData(agentId);\n\n        for (const [key, value] of Object.entries(mockData)) {\n            let output = {};\n            if (value && Object.keys(value).length > 0) {\n                output = (value as any)?.data?.outputs;\n            }\n            if (output && Object.keys(output).length > 0) {\n                body.push({\n                    id: key,\n                    ctx: {\n                        active: false,\n                        output,\n                    },\n                });\n            }\n        }\n    } catch (error) {\n        console.warn('Error getting mock data', error);\n    }\n\n    // When we have mock data to inject, we need to set the x-mock-data-inj header\n    if (body?.length > 0) {\n        req.headers['x-mock-data-inj'] = '';\n    }\n\n    // If the body is an empty object, we need to convert it to an array\n    const existingBody = Object.keys(req.body).length === 0 ? [] : req.body;\n\n    if (Array.isArray(existingBody)) {\n        const existingComponentIds = existingBody?.map((item) => item.id) || [];\n\n        body = body.filter((item) => !existingComponentIds.includes(item.id));\n\n        req.body = [...existingBody, ...body];\n    }\n}\n\nexport async function processAgentRequest(req: any, reqOverride?: any) {\n    const agentData = req._agentData;\n    const agentId = agentData?.id;\n    if (!agentData) {\n        return { status: 404, data: 'Agent not found' };\n    }\n\n    //const agentId = agentData.id;\n    const agentProcess = AgentProcess.load(agentData);\n\n    if (!agentProcess) {\n        return { status: 404, data: 'Agent not found' };\n    }\n\n    await agentProcess.ready();\n\n    const usingTestDomain = agentData.usingTestDomain;\n    const debugSessionEnabled = agentData.debugSessionEnabled;\n    const hasDebugHeaders = Object.keys(req.headers).some((key) => key.toLowerCase().startsWith('x-debug-'));\n\n    if (usingTestDomain) handleMonitorIds(req, agentProcess);\n\n    let startLiveDebug =\n        usingTestDomain &&\n        debugSessionEnabled &&\n        typeof req.header('X-DEBUG-SKIP') == 'undefined' &&\n        typeof req.header('X-DEBUG-RUN') == 'undefined' &&\n        typeof req.header('X-DEBUG-read') == 'undefined' &&\n        typeof req.header('X-DEBUG-INJ') == 'undefined' &&\n        typeof req.header('X-DEBUG-STOP') == 'undefined';\n\n    if (hasDebugHeaders || startLiveDebug) {\n        const readStateId: string = req.header('X-DEBUG-READ') || '';\n        if (readStateId) {\n            //just return the agent state ann exit\n            return await readAgentState(req, agentProcess, readStateId);\n        }\n\n        // #region[mock_data]\n        await handleMockData(req, agentProcess);\n        // #endregion[mock_data]\n    }\n\n    let result;\n    if (startLiveDebug) {\n        result = await runAgentDebug(agentId, agentProcess, req);\n    } else {\n        result = await runAgentProcess(agentId, agentProcess, req);\n    }\n\n    //if the request has debug headers, and requested to include the new state, read the new state from the agent context\n    if (hasDebugHeaders || startLiveDebug) {\n        const { includeNewState } = req.query || {};\n        if (includeNewState) {\n            const readStateId = result?.data?.dbgSession;\n            if (readStateId) {\n                const newState = await readAgentState(req, agentProcess, readStateId);\n                result.data.newState = result.status === 200 ? newState.data : null;\n            }\n        }\n    }\n    return result;\n}\n\nasync function runAgentProcess(agentId: string, agentProcess: AgentProcess, req: any) {\n    try {\n        //const req = agent.agentRequest;\n        const debugPromiseId = `${agentId}`;\n\n        if (req.header('X-DEBUG-STOP')) {\n            if (debugPromises[debugPromiseId]) {\n                console.log(\n                    `Debug session for agent ${agentId} with session id ${debugPromiseId} stopped because of X-DEBUG-STOP header. DELETING PROMISE`,\n                );\n                const dbgPromise: any = debugPromises[debugPromiseId];\n                delete debugPromises[debugPromiseId];\n                dbgPromise.resolve({ status: 400, error: 'Debug Session Stopped' });\n            }\n        }\n\n        //at this point dbgPromise might not exist yet\n        let dbgPromise = debugPromises[debugPromiseId];\n        if (dbgPromise?.sse) {\n            //this sse was set by the runAgentDebug() function\n            //we need to propagate it in order to capture each execution step stream in the same SSE monitor\n            agentProcess.agent.addSSE(dbgPromise.sse);\n        }\n        //extract endpoint path\n        //live agents (dev) do not have a version number\n        //deployed agents have a version number\n        const pathMatches = req.path.match(/(^\\/v[0-9]+\\.[0-9]+?)?(\\/(api|trigger)\\/(.+)?)/);\n        if (!pathMatches || !pathMatches[2]) {\n            return { status: 404, data: { error: 'Endpoint not found' } };\n        }\n\n        const { data: result } = await agentProcess\n            .run({\n                ...req,\n                path: req.path,\n                url: undefined,\n                headers: {\n                    ...req.headers,\n                    //'X-DEBUG-RUN': '',\n                },\n            })\n            .catch((error) => ({ data: { error: error.toString() } }));\n\n        if (result?.error) {\n            if (result.error !== 'AGENT_KILLED') console.error('ERROR', result.error);\n            //res.status(500).json({ ...result, error: result.error.toString(), agentId: agent.id, agentName: agent.name });\n            return {\n                status: 500,\n                data: {\n                    ...result,\n                    error: result.error.toString(),\n                    agentId: agentId,\n                    // agentName: agent?.name\n                    agentName: undefined,\n                },\n            };\n        }\n        //handle API embodiments debug response\n        const dbgSession = result?.dbgSession || result?.expiredDbgSession || '';\n        dbgPromise = debugPromises[debugPromiseId];\n        if (dbgSession && dbgPromise) {\n            if (result.finalResult) {\n                //const result = debugPromises[agent.id].result;\n                console.log(\n                    `Debug session for agent ${agentId} with session id ${debugPromiseId} resolved since the final result is available. DELETING PROMISE`,\n                );\n                delete debugPromises[debugPromiseId];\n\n                dbgPromise.resolve(result.finalResult);\n            }\n        }\n        return { status: 200, data: result };\n    } catch (error: any) {\n        console.error(error);\n        if (error.response) {\n            // The request was made, but the server responded with a non-2xx status\n            return { status: error.response.status, data: error.response.data };\n        } else {\n            // Some other error occurred\n            return { status: 500, data: 'Internal Server Error' };\n        }\n    }\n}\nasync function runAgentDebug(agentId: string, agentProcess: AgentProcess, req: Request) {\n    try {\n        //const req = agent.agentRequest;\n        const debugPromiseId = `${agentId}`;\n\n        const excludedHeaders = ['host', 'content-length', 'accept-encoding'];\n        const headers = Object.keys(req.headers)\n            .filter((header) => !excludedHeaders.includes(header.toLowerCase()))\n            .reduce((obj, header) => {\n                obj[header] = req.headers[header];\n                return obj;\n            }, {});\n        headers['X-AGENT-ID'] = agentId;\n        headers['X-DEBUG-RUN'] = '';\n\n        //'X-DEBUG-RUN': '',\n        const port = process.env.PORT || 3000;\n\n        let url = `http://localhost:${port}${req.path.replace('/debug', '/api')}`;\n        //add query params\n        // * query params will add with 'params' property in axios to parse Object type data properly\n        /* if (req.query) {\n            const query = Object.keys(req.query)\n                .map((key) => `${key}=${req.query[key]}`)\n                .join('&');\n            url += `?${query}`;\n        } */\n\n        const input = req.method == 'GET' ? req.query : req.body;\n\n        //check if request has form-data\n\n        //the following line does not handle get request case\n        //const apiResponse = await axios.post(url, input, { headers }); //call the actual agentAPI locally\n\n        let apiResponse;\n        //make sure to map binary data back to the request body that we'll send to the agent\n        // @ts-ignore\n        if (req.files) {\n            //send request with formData\n            const formData = new FormData();\n            //@ts-ignore\n            for (let file of req.files) {\n                const fieldname = file.fieldname;\n                //get blob from file.buffer\n                const blob = new Blob([file.buffer], { type: file.mimetype });\n\n                formData.append(fieldname, blob, file.originalname);\n            }\n            for (let entry in req.body) {\n                formData.append(entry, req.body[entry]);\n            }\n\n            apiResponse = await axios({\n                method: req.method,\n                url,\n                data: formData,\n                headers,\n                params: req.query,\n            });\n        } else {\n            //send request with json body\n            apiResponse = await axios({\n                method: req.method,\n                url,\n                data: req.body,\n                headers,\n                params: req.query,\n            });\n        }\n        //const apiAgentResponse = await runAgentProcess(agent); //TODO : refactor the internal logic to use runAgentProcess() instead of making a post request\n        const dbgSession = apiResponse?.data?.dbgSession;\n        if (dbgSession) {\n            //const agentId = agent.id;\n            if (debugPromises[debugPromiseId]) {\n                console.log(\n                    `Tried to start a new debug session for agent ${agentId}, but a session is already running. req path ${req.path} and url ${req.url}. DELETING THE OLD PROMISE TO START A NEW ONE`,\n                );\n\n                agentProcess?.agent?.sse?.close();\n                const dbgPromise: any = debugPromises[debugPromiseId];\n                dbgPromise.reject({\n                    status: 400,\n                    data: { error: 'Debug session interrupted by another request', details: { debugPromiseId, session: dbgPromise.dbgSession } },\n                });\n\n                delete debugPromises[debugPromiseId];\n            }\n            const sessionPromise = new Promise((resolve, reject) => {\n                console.log(\n                    `A new debug session is started for agent ${agentId} with session id ${dbgSession} and req path ${req.path} and url${req.url}. CLIENT IP: ${req.headers['x-forwarded-for']} - ${req?.socket?.remoteAddress}. X-HASH-ID: ${req.headers['x-hash-id']}`,\n                );\n                debugPromises[debugPromiseId] = { dbgSession, resolve, reject, sse: agentProcess.agent.sse };\n                //promise expiration\n                setTimeout(\n                    () => {\n                        console.log(`Debug session for agent ${agentId} with session id ${dbgSession} expired. DELETING PROMISE`);\n                        delete debugPromises[debugPromiseId];\n                        reject({ status: 500, data: 'Debug Session Expired' });\n                    },\n                    60 * 60 * 1000, // 1 hour\n                );\n            });\n\n            const finalResult: any = await sessionPromise.catch((error) => ({\n                error,\n            }));\n\n            agentProcess?.agent?.sse?.close();\n\n            if (finalResult?.error) {\n                return {\n                    status: finalResult.status || 500,\n                    data: { error: finalResult.error },\n                };\n            }\n\n            let data = finalResult;\n\n            return { status: 200, data };\n        }\n        //res.status(apiResponse.status).send(apiResponse.data);\n    } catch (error: any) {\n        if (error.response) {\n            // The request was made, but the server responded with a non-2xx status\n            console.error(error.response.status, error.response.data);\n            return { status: error.response.status, data: error.response.data };\n        } else {\n            // Some other error occurred\n            console.error(error);\n            return { status: 500, data: 'Internal Server Error' };\n        }\n    }\n}\n\nprocess.on('MANAGEMENT:DISABLE_PORT' as any, async () => {\n    // close each connection at once using promise.all\n    console.log('Closing all SSE connections');\n    sseConnections.forEach((connection) => {\n        connection.res.end();\n    });\n    sseConnections.clear();\n});\n","import AgentLoader from '@/middlewares/AgentLoader.mw';\nimport uploadHandlerFactory from '@/middlewares/UploadHandlerFactory.mw';\nimport cors from '@/middlewares/CORS.mw';\nimport RemoveHeadersFactory from '@/middlewares/RemoveHeadersFactory.mw';\nimport { Logger } from '@smythos/sdk/core';\nimport express from 'express';\n\nimport { createSseConnection, getDebugSession, processAgentRequest } from './AgentRequestHandler';\nconst console = Logger('AgentRole');\n\nexport class AgentRole {\n    private maxFileSize: number;\n    private maxFileCount: number;\n    private enableDebugger: boolean;\n    private enableTriggers: boolean;\n    private enableMonitor: boolean;\n    constructor(\n        private middlewares: express.RequestHandler[],\n        options: {\n            maxUploadSize?: number;\n            maxUploadsCount?: number;\n            enableDebugger?: boolean;\n            enableMonitor?: boolean;\n            enableTriggers?: boolean;\n        },\n    ) {\n        this.maxFileSize = options.maxUploadSize || 1024 * 1024 * 10; // 10MB\n        this.maxFileCount = options.maxUploadsCount || 5;\n        this.enableDebugger = options.enableDebugger || false;\n        this.enableMonitor = options.enableMonitor || false;\n        this.enableTriggers = options.enableTriggers || false;\n    }\n    public async mount(router: express.Router) {\n        const uploadHandler = uploadHandlerFactory(this.maxFileSize, this.maxFileCount);\n        const middlewares = [cors, uploadHandler, AgentLoader, ...this.middlewares];\n        if (!this.enableDebugger) {\n            const removeDebugHeaders = RemoveHeadersFactory(['x-debug-skip', 'x-debug-run', 'x-debug-inj', 'x-debug-read']);\n            middlewares.unshift(removeDebugHeaders);\n        }\n        if (!this.enableMonitor) {\n            const removeMonitorHeaders = RemoveHeadersFactory(['x-monitor-id']);\n            middlewares.unshift(removeMonitorHeaders);\n        }\n\n        router.options('*', [cors]); //enable CORS for preflight requests\n\n        if (this.enableDebugger) {\n            router.get('/agent/:id/debugSession', [cors], (req, res, next) => {\n                console.log(\n                    `Getting debug session for agent ${req.params.id} with client IP ${req.headers['x-forwarded-for']} - ${req.socket.remoteAddress}. x-hash-id ${req.headers['x-hash-id']}`,\n                );\n                const dbgSession = getDebugSession(req.params.id);\n                res.send({ dbgSession });\n            });\n        }\n\n        if (this.enableMonitor) {\n            router.get('/agent/:id/monitor', [cors], (req, res, next) => {\n                const sseId = createSseConnection(req);\n\n                // Set headers for SSE\n                res.setHeader('Content-Type', 'text/event-stream');\n                res.setHeader('Cache-Control', 'no-cache');\n                res.setHeader('Connection', 'keep-alive');\n\n                // Send the unique ID as the first event\n                res.write(`event: init\\n`);\n                res.write(`data: ${sseId}\\n\\n`);\n            });\n        }\n\n        const reqHandler = async (req, res) => {\n            try {\n                const agentData: any = req._agentData;\n                if (!agentData) {\n                    res.status(404).json({ error: 'Agent not found' });\n                    return;\n                }\n                const result: any = await processAgentRequest(req);\n                if (!res.headersSent) {\n                    res.status(result?.status || 500).send(result?.data);\n                }\n            } catch (error) {\n                res.status(500).json({ error: error.message || 'Internal server error' });\n            }\n        };\n\n        if (this.enableTriggers) {\n            router.post(`/trigger/:name`, middlewares, reqHandler);\n            router.get(`/trigger/:name`, middlewares, reqHandler);\n        }\n\n        router.post(`/api/*`, middlewares, reqHandler);\n        router.get(`/api/*`, middlewares, reqHandler);\n\n        router.post(`/:version/api/*`, middlewares, reqHandler);\n        router.get(`/:version/api/*`, middlewares, reqHandler);\n\n        router.post(/^\\/v[0-9]+(\\.[0-9]+)?\\/api\\/(.+)/, middlewares, reqHandler);\n        router.get(/^\\/v[0-9]+(\\.[0-9]+)?\\/api\\/(.+)/, middlewares, reqHandler);\n    }\n}\n","import axios from 'axios';\n\nimport { ConnectorService, Conversation } from '@smythos/sdk/core';\n\nconst SPEAKABLE_FORMAT_PROMPT = 'Return the response in speakable format';\nconst ALEXA_BASE_URL = 'https://api.amazonalexa.com';\nconst ALEXA_SETTINGS_KEY = 'alexa';\n\nexport async function handleAlexaRequest({\n    isEnabled,\n    model,\n    alexRequest,\n    agentData,\n    serverOrigin,\n}: {\n    isEnabled: boolean;\n    model: string;\n    alexRequest: any;\n    agentData: any;\n    serverOrigin: string;\n}) {\n    if (!isEnabled) {\n        return buildAlexaResponse('Alexa is not enabled for this agent');\n    }\n    if (alexRequest.type === 'LaunchRequest') {\n        return buildAlexaResponse('Hi I am smythos agent. What can I help you with?');\n    }\n    const query = alexRequest.slots.searchQuery.heardAs;\n    const agentResponse = await processAlexaSearchQuery({ query, model, agentData, serverOrigin });\n    const response = buildAlexaResponse(agentResponse);\n    return response;\n}\n\nexport function parseAlexaRequest(alexRequest: any) {\n    const type = alexRequest.request.type;\n    const intent = alexRequest.request.intent;\n    const slots = intent?.slots ? getSlotValues(intent.slots) : {};\n    return { type, intent, slots };\n}\n\nexport function getSlotValues(filledSlots) {\n    const slotValues = {};\n\n    Object.keys(filledSlots).forEach((item) => {\n        const name = filledSlots[item].name;\n\n        if (\n            filledSlots[item] &&\n            filledSlots[item].resolutions &&\n            filledSlots[item].resolutions.resolutionsPerAuthority[0] &&\n            filledSlots[item].resolutions.resolutionsPerAuthority[0].status &&\n            filledSlots[item].resolutions.resolutionsPerAuthority[0].status.code\n        ) {\n            switch (filledSlots[item].resolutions.resolutionsPerAuthority[0].status.code) {\n                case 'ER_SUCCESS_MATCH':\n                    slotValues[name] = {\n                        heardAs: filledSlots[item].value,\n                        resolved: filledSlots[item].resolutions.resolutionsPerAuthority[0].values[0].value.name,\n                        ERstatus: 'ER_SUCCESS_MATCH',\n                    };\n                    break;\n                case 'ER_SUCCESS_NO_MATCH':\n                    slotValues[name] = {\n                        heardAs: filledSlots[item].value,\n                        resolved: '',\n                        ERstatus: 'ER_SUCCESS_NO_MATCH',\n                    };\n                    break;\n                default:\n                    break;\n            }\n        } else {\n            slotValues[name] = {\n                heardAs: filledSlots[item].value || '', // may be null\n                resolved: '',\n                ERstatus: '',\n            };\n        }\n    }, this);\n\n    return slotValues;\n}\n\nexport function buildAlexaResponse(outputSpeech: string, reprompt = '', shouldEndSession = false) {\n    return {\n        version: '1.0',\n        sessionAttributes: {},\n        response: {\n            outputSpeech: {\n                type: 'PlainText',\n                text: outputSpeech,\n            },\n            reprompt: {\n                outputSpeech: {\n                    type: 'PlainText',\n                    text: reprompt,\n                },\n            },\n            shouldEndSession: shouldEndSession,\n        },\n    };\n}\n\nexport async function createAlexaSkill(agentName: string, accessToken: string, vendorId: string, endpoint: string) {\n    try {\n        const response = await axios({\n            method: 'post',\n            url: `${ALEXA_BASE_URL}/v1/skills`,\n            headers: {\n                Authorization: 'Bearer ' + accessToken,\n                'Content-Type': 'application/json',\n            },\n            data: {\n                vendorId: vendorId,\n                manifest: {\n                    apis: {\n                        custom: {\n                            endpoint: {\n                                sslCertificateType: 'Wildcard',\n                                uri: endpoint,\n                            },\n                            interfaces: [],\n                            locales: {},\n                        },\n                    },\n                    manifestVersion: '1.0',\n                    publishingInformation: {\n                        category: 'ORGANIZERS_AND_ASSISTANTS',\n                        locales: {\n                            'en-US': {\n                                description: 'Smythos agent',\n                                examplePhrases: ['Alexa open ' + agentName],\n                                keywords: [agentName],\n                                name: agentName,\n                                summary: 'invoke ' + agentName,\n                            },\n                        },\n                    },\n                },\n            },\n        });\n        const skillId = response.data.skillId;\n        await new Promise((resolve) => setTimeout(resolve, 2000));\n\n        await axios({\n            method: 'put',\n            url: `${ALEXA_BASE_URL}/v1/skills/${skillId}/stages/development/interactionModel/locales/en-US`,\n            headers: {\n                Authorization: 'Bearer ' + accessToken,\n                'Content-Type': 'application/json',\n            },\n            data: {\n                interactionModel: {\n                    languageModel: {\n                        invocationName: agentName.toLowerCase(),\n                        intents: [\n                            {\n                                name: 'AMAZON.CancelIntent',\n                                samples: [],\n                            },\n                            {\n                                name: 'AMAZON.HelpIntent',\n                                samples: [],\n                            },\n                            {\n                                name: 'AMAZON.StopIntent',\n                                samples: [],\n                            },\n                            {\n                                name: 'AMAZON.FallbackIntent',\n                                samples: [],\n                            },\n                            {\n                                name: 'AMAZON.NavigateHomeIntent',\n                                samples: [],\n                            },\n                            {\n                                name: 'SmythosQuery',\n                                slots: [\n                                    {\n                                        name: 'searchQuery',\n                                        type: 'AMAZON.SearchQuery',\n                                    },\n                                ],\n                                samples: ['Hi {searchQuery}', 'Hello {searchQuery}'],\n                            },\n                        ],\n                        types: [],\n                    },\n                },\n            },\n        });\n        return skillId;\n    } catch (error: any) {\n        console.error(error?.response?.data);\n    }\n}\n\nexport function processAlexaSearchQuery({\n    query,\n    model,\n    agentData,\n    serverOrigin,\n}: {\n    query: string;\n    model: string;\n    agentData: any;\n    serverOrigin: string;\n}): Promise<string> {\n    return new Promise((resolve, reject) => {\n        let result = '';\n\n        const agentDataConnector = ConnectorService.getAgentDataConnector();\n\n        agentDataConnector\n            .getOpenAPIJSON(agentData, serverOrigin, agentData.usingTestDomain ? '' : 'latest', true)\n            .then((spec) => {\n                const conversation = new Conversation(model, spec, {\n                    agentId: agentData.id,\n                });\n                conversation.on('error', (error) => {\n                    console.error('Error in conversation:', error);\n                    reject(new Error('An error occurred. Please try again later or select a different model.'));\n                });\n                conversation.on('content', (content) => {\n                    if (content?.indexOf('}{') >= 0) {\n                        content = content.replace(/}{/g, '} {');\n                    }\n                    result += content;\n                });\n                conversation.on('end', () => {\n                    console.log('streaming: [DONE]');\n                    resolve(result);\n                });\n                conversation.streamPrompt(`${query} ${SPEAKABLE_FORMAT_PROMPT}`, {\n                    'X-AGENT-ID': agentData.id,\n                });\n            })\n            .catch((error) => {\n                reject(error);\n            });\n    });\n}\n\nexport function isAlexaEnabled(agentData: any, agentSettings: any) {\n    if (agentData.usingTestDomain) {\n        return true;\n    }\n    return agentSettings?.get(ALEXA_SETTINGS_KEY) === 'true';\n}\n","import express from 'express';\n\nimport { DEFAULT_AGENT_MODEL, DEFAULT_AGENT_MODEL_SETTINGS_KEY } from '@/constants';\nimport AgentLoader from '@/middlewares/AgentLoader.mw';\nimport { BaseRole } from '@/roles/Base.role';\nimport type { ModelResolver, ServerOriginResolver } from '@/types/resolvers.types';\n\nimport { createAlexaSkill, handleAlexaRequest, isAlexaEnabled, parseAlexaRequest } from './Alexa.service';\n\nexport class AlexaRole extends BaseRole {\n    /**\n     * Creates a new AlexaRole instance.\n     * @param middlewares - The custom middlewares to apply to the role on top of the default middlewares.\n     * @param options - The options for the role\n     * @param options.serverOrigin - Server origin URL: string for static, or function to resolve dynamically from request\n     * @param options.model - Optional model override: string for static model, or function to resolve model dynamically\n     */\n    constructor(middlewares: express.RequestHandler[] = [], options: { serverOrigin: ServerOriginResolver; model?: ModelResolver }) {\n        super(middlewares, options);\n    }\n\n    public async mount(router: express.Router) {\n        const middlewares = [AgentLoader, ...this.middlewares];\n\n        router.post('/', middlewares, async (req: express.Request, res: express.Response) => {\n            try {\n                const agentData = req._agentData;\n                const agentSettings = req._agentSettings;\n                await agentSettings?.ready();\n                const isEnabled = isAlexaEnabled(agentData, agentSettings);\n                // wait for agent embodiments to be ready\n                await agentSettings?.embodiments?.ready();\n\n                // Resolve server origin: static string or dynamic from request\n                const serverOrigin = this.resolve(this.options.serverOrigin, req);\n\n                const alexRequest = parseAlexaRequest(req.body);\n\n                // Get base model from agent settings or use system default\n                const baseModel = agentSettings?.get(DEFAULT_AGENT_MODEL_SETTINGS_KEY) || DEFAULT_AGENT_MODEL;\n\n                // Apply model resolution strategy: static string, dynamic function, or default to base model\n                const model = this.resolve(this.options?.model, { baseModel, planInfo: agentData?.planInfo || {} }, baseModel);\n\n                const response = await handleAlexaRequest({\n                    isEnabled,\n                    model,\n                    alexRequest,\n                    agentData,\n                    serverOrigin,\n                });\n\n                res.json(response);\n            } catch (error: unknown) {\n                console.error(error);\n                return res.status(500).send({ error: (error as Error).message });\n            }\n        });\n\n        router.post('/publish', middlewares, async (req: express.Request, res: express.Response) => {\n            try {\n                const agentData = req._agentData;\n                const agentName = agentData.name;\n                const agentDomain = agentData.domain;\n                const accessToken = req.body.accessToken;\n                const vendorId = req.body.vendorId;\n                const scheme = agentDomain.includes(':') ? 'http' : 'https';\n                const endpoint = `${scheme}://${agentDomain}/alexa`;\n\n                await createAlexaSkill(agentName, accessToken, vendorId, endpoint);\n\n                return res.json({ success: true, message: 'Agent published to Alexa successfully' });\n            } catch (error: unknown) {\n                console.error('Error publishing to Alexa:', error);\n                return res.status(500).json({ success: false, error: (error as Error).message });\n            }\n        });\n    }\n}\n","import express from 'express';\n\nimport { ConnectorService } from '@smythos/sdk/core';\n\nimport AgentLoader from '@/middlewares/AgentLoader.mw';\nimport { BaseRole } from '@/roles/Base.role';\n\nexport class ChatGPTRole extends BaseRole {\n    /**\n     * Creates a new ChatGPTRole instance.\n     *\n     * This role provides ChatGPT-compatible OpenAPI specifications for SmythOS agents.\n     * It transforms the standard OpenAPI 3.0.1 spec to 3.1.0 format required by ChatGPT Actions,\n     * and handles GPT-specific limitations (e.g., 300 character summary limits).\n     *\n     * @param middlewares - Custom middlewares to apply on top of default middlewares\n     * @param options - Configuration options for the role\n     * @param options.serverOrigin - Server origin URL (string or function that returns string from request)\n     *                                Used for generating absolute URLs in the OpenAPI spec\n     */\n    constructor(middlewares: express.RequestHandler[], options: { serverOrigin: string | ((req: express.Request) => string) }) {\n        super(middlewares, options);\n    }\n\n    /**\n     * Mounts the ChatGPT role routes on the provided router.\n     *\n     * Registers a GET endpoint at `/api-docs/openapi-gpt.json` that serves\n     * a ChatGPT-compatible OpenAPI 3.1.0 specification for the agent.\n     *\n     * @param router - Express router to mount the routes on\n     */\n    public async mount(router: express.Router) {\n        const middlewares = [AgentLoader, ...this.middlewares];\n\n        router.get('/api-docs/openapi-gpt.json', middlewares, async (req: express.Request, res: express.Response) => {\n            const agentData = req._agentData;\n\n            // Resolve server origin from options (static value or dynamic function)\n            const serverOrigin = this.resolve(this.options.serverOrigin, req);\n\n            // Fetch the base OpenAPI 3.0.1 specification from agent data\n            const agentDataConnector = ConnectorService.getAgentDataConnector();\n            const openAPIObj = await agentDataConnector.getOpenAPIJSON(agentData, serverOrigin, agentData.version, false);\n\n            if (openAPIObj?.error) {\n                return res.status(500).send({ error: openAPIObj.error });\n            }\n\n            // Transform from OpenAPI 3.0.1 to 3.1.0 format for ChatGPT Actions compatibility\n            const transformedSpec = transformOpenAPI301to310(openAPIObj);\n\n            // ChatGPT Actions has a 300 character limit for operation summaries\n            // Truncate summaries at sentence boundaries to fit within this limit\n            // TODO: Consider using an LLM to intelligently rephrase summaries instead of truncating\n            if ('paths' in transformedSpec) {\n                for (const path in transformedSpec.paths) {\n                    const entry = transformedSpec.paths[path];\n                    for (const method in entry) {\n                        if (!entry[method].summary) continue;\n                        entry[method].summary = splitOnSeparator(entry[method].summary, 300, '.');\n                    }\n                }\n            }\n\n            // Return the transformed OpenAPI specification as JSON\n            res.setHeader('Content-Type', 'application/json');\n            res.send(JSON.stringify(transformedSpec, null, 2));\n        });\n    }\n}\n\n/**\n * Transforms OpenAPI 3.0.1 specification to 3.1.0 format\n *\n * Key transformations:\n * - Updates version number to '3.1.0'\n * - Converts `nullable: true` to union types with 'null'\n * - Handles binary format by converting to base64 string with `contentEncoding`\n * - Fixes empty array items by defaulting to string type\n * - Transforms empty `additionalProperties` objects to `true`\n * - Recursively processes all schemas in paths, components, request bodies, responses, and parameters\n * - Handles nested schema structures (allOf, oneOf, anyOf, not)\n *\n * @param spec - The OpenAPI 3.0.1 specification object\n * @returns The transformed OpenAPI 3.1.0 specification\n */\nfunction transformOpenAPI301to310(spec: any): any {\n    // Deep clone to avoid mutating original\n    const transformed = JSON.parse(JSON.stringify(spec));\n\n    // Update version\n    transformed.openapi = '3.1.0';\n\n    // Transform schemas recursively\n    function transformSchema(schema: any): any {\n        if (!schema || typeof schema !== 'object') return schema;\n\n        // Handle array schemas - ensure items is properly defined\n        if (schema.type === 'array') {\n            if (!schema.items || Object.keys(schema.items).length === 0) {\n                schema.items = { type: 'string' }; // Default to string items\n            } else {\n                schema.items = transformSchema(schema.items);\n            }\n        }\n\n        // Handle object schemas - fix empty additionalProperties\n        if (schema.type === 'object') {\n            if (\n                schema.additionalProperties !== undefined &&\n                typeof schema.additionalProperties === 'object' &&\n                Object.keys(schema.additionalProperties).length === 0\n            ) {\n                schema.additionalProperties = true; // Allow any additional properties\n            }\n\n            // Transform nested properties\n            if (schema.properties) {\n                for (const [key, prop] of Object.entries(schema.properties)) {\n                    schema.properties[key] = transformSchema(prop);\n                }\n            }\n        }\n\n        // Handle binary format - convert to string with contentEncoding\n        if (schema.format === 'binary') {\n            delete schema.format;\n            schema.type = 'string';\n            schema.contentEncoding = 'base64';\n        }\n\n        // Handle nullable fields (3.0.1 -> 3.1.0)\n        if (schema.nullable === true) {\n            delete schema.nullable;\n            // Convert to union type with null\n            if (schema.type) {\n                schema.type = Array.isArray(schema.type) ? [...schema.type, 'null'] : [schema.type, 'null'];\n            }\n        }\n\n        // Recursively transform nested schemas\n        if (schema.allOf) schema.allOf = schema.allOf.map(transformSchema);\n        if (schema.oneOf) schema.oneOf = schema.oneOf.map(transformSchema);\n        if (schema.anyOf) schema.anyOf = schema.anyOf.map(transformSchema);\n        if (schema.not) schema.not = transformSchema(schema.not);\n\n        return schema;\n    }\n\n    // Transform request/response schemas in paths\n    if (transformed.paths) {\n        for (const pathItem of Object.values(transformed.paths)) {\n            for (const operation of Object.values(pathItem as any)) {\n                if (typeof operation !== 'object' || !operation) continue;\n\n                const op = operation as any;\n\n                // Transform request body schemas\n                if (op.requestBody?.content) {\n                    for (const mediaObj of Object.values(op.requestBody.content)) {\n                        if ((mediaObj as any).schema) {\n                            (mediaObj as any).schema = transformSchema((mediaObj as any).schema);\n                        }\n                    }\n                }\n\n                // Transform response schemas\n                if (op.responses) {\n                    for (const response of Object.values(op.responses)) {\n                        if ((response as any).content) {\n                            for (const mediaObj of Object.values((response as any).content)) {\n                                if ((mediaObj as any).schema) {\n                                    (mediaObj as any).schema = transformSchema((mediaObj as any).schema);\n                                }\n                            }\n                        }\n                    }\n                }\n\n                // Transform parameter schemas\n                if (op.parameters) {\n                    op.parameters = op.parameters.map((param: any) => {\n                        if (param.schema) {\n                            param.schema = transformSchema(param.schema);\n                        }\n                        return param;\n                    });\n                }\n            }\n        }\n    }\n\n    // Transform component schemas\n    if (transformed.components?.schemas) {\n        for (const [name, schema] of Object.entries(transformed.components.schemas)) {\n            transformed.components.schemas[name] = transformSchema(schema);\n        }\n    }\n\n    return transformed;\n}\n\n/**\n * Truncates a string to a maximum length, preferring to break at a separator for cleaner truncation.\n *\n * Used to ensure operation summaries fit within ChatGPT's 300 character limit while maintaining\n * readability by breaking at sentence boundaries when possible.\n *\n * @param str - The string to truncate (defaults to empty string)\n * @param maxLen - Maximum allowed length\n * @param separator - Preferred character to break at (defaults to '.')\n * @returns The truncated string, broken at the last separator before maxLen if found,\n *          otherwise truncated at maxLen\n *\n * @example\n * splitOnSeparator(\"First sentence. Second sentence. Third sentence.\", 30, \".\")\n * // Returns: \"First sentence. Second sentence\"\n */\nfunction splitOnSeparator(str = '', maxLen: number, separator = ' .') {\n    // Return as-is if already within limit\n    if (str.length <= maxLen) {\n        return str;\n    }\n\n    // Find the last occurrence of the separator before maxLen to break at a clean boundary\n    const idx = str.lastIndexOf(separator, maxLen);\n\n    // If separator not found, hard truncate at maxLen\n    if (idx === -1) {\n        return str.substring(0, maxLen);\n    }\n\n    // Truncate at the last separator for a clean break\n    return str.substring(0, idx);\n}\n","const MCP_SETTINGS_KEY = 'mcp';\n\nexport const isMcpEnabled = (agentData: any, agentSettings) => {\n    if (agentData.usingTestDomain) {\n        return true;\n    }\n    const mcpSettings = agentSettings?.get(MCP_SETTINGS_KEY);\n    let isEnabled = false;\n    if (mcpSettings) {\n        try {\n            const parsedMcpSettings = JSON.parse(mcpSettings);\n            isEnabled = typeof parsedMcpSettings === 'boolean' ? parsedMcpSettings : parsedMcpSettings?.isEnabled;\n        } catch (error) {\n            isEnabled = false;\n        }\n    }\n    return isEnabled;\n};\n\nexport function extractMCPToolSchema(jsonSpec: any, method: string) {\n    if (method.toLowerCase() === 'get') {\n        const schema = jsonSpec?.parameters;\n        if (!schema) return {};\n\n        const properties = {};\n        const required = [];\n\n        schema.forEach((param) => {\n            if (param.in === 'query') {\n                properties[param.name] = param.schema;\n                if (param.required) {\n                    required.push(param.name);\n                }\n            }\n        });\n\n        return {\n            type: 'object',\n            properties,\n            required,\n        };\n    }\n    const schema = jsonSpec?.requestBody?.content?.['application/json']?.schema;\n    return schema;\n}\n\nexport function formatMCPSchemaProperties(schema: any) {\n    const properties = schema?.properties || {};\n    for (const property in properties) {\n        const propertySchema = properties[property];\n\n        if (propertySchema.type === 'array') {\n            properties[property] = {\n                type: 'array',\n                items: {\n                    type: ['string', 'number', 'boolean', 'object', 'array'],\n                },\n            };\n        }\n    }\n    return properties;\n}\n\n","import express from 'express';\n\nimport { Server as McpServer } from '@modelcontextprotocol/sdk/server/index.js';\nimport { SSEServerTransport } from '@modelcontextprotocol/sdk/server/sse.js';\nimport { CallToolRequestSchema, ListToolsRequestSchema, Tool } from '@modelcontextprotocol/sdk/types.js';\n\nimport { AgentProcess, ConnectorService, Logger } from '@smythos/sdk/core';\n\nimport AgentLoader from '@/middlewares/AgentLoader.mw';\nimport { BaseRole } from '@/roles/Base.role';\n\nimport { extractMCPToolSchema, formatMCPSchemaProperties } from './MCP.service';\n\n// TODO:\n// * 1. Replace Deprecated Server with McpServer\n// * 2. Implement StreamableHTTPServerTransport, and keep the SSEServerTransport for backward compatibility\n\nconst console = Logger('Role: MCP');\n\nconst clientTransports = new Map<string, { transport: SSEServerTransport; server: McpServer }>();\n\nexport class MCPRole extends BaseRole {\n    /**\n     * Creates a new MCPRole instance.\n     * @param middlewares - The custom middlewares to apply to the role on top of the default middlewares.\n     * @param options - The options for the role. Defaults to an empty object.\n     */\n    constructor(middlewares: express.RequestHandler[] = [], options: Record<string, unknown> = {}) {\n        super(middlewares, options);\n    }\n\n    public async mount(router: express.Router) {\n        const middlewares = [AgentLoader, ...this.middlewares];\n\n        router.get('/sse', middlewares, async (req: express.Request, res: express.Response) => {\n            try {\n                const agentData = req._agentData;\n\n                const agentDataConnector = ConnectorService.getAgentDataConnector();\n                const openAPISpec = await agentDataConnector.getOpenAPIJSON(agentData, 'localhost', 'latest', true);\n\n                // Server implementation\n                const server = new McpServer(\n                    {\n                        name: openAPISpec.info.title,\n                        version: openAPISpec.info.version,\n                    },\n                    {\n                        capabilities: {\n                            tools: {},\n                        },\n                    },\n                );\n                req.on('error', (error: unknown) => {\n                    console.error('Error:', error);\n                    // server.close();\n                });\n\n                // Handle client disconnect\n                req.on('close', () => {\n                    console.log('Client disconnected');\n                    clientTransports.delete(transport.sessionId);\n                    // server.close();\n                });\n\n                server.onerror = (error: unknown) => {\n                    console.error('Server error:', error);\n                    // server.close();\n                };\n\n                server.onclose = async () => {\n                    console.log('Server closing');\n                    // await server.close();\n                    // process.exit(0);\n                };\n                // Extract available endpoints and their methods\n                const tools: Tool[] = Object.entries(openAPISpec.paths).map(([path, methods]) => {\n                    const method = Object.keys(methods)[0];\n                    const endpoint = path.split('/api/')[1];\n                    const operation = methods[method];\n                    const schema = extractMCPToolSchema(operation, method);\n                    const properties = formatMCPSchemaProperties(schema);\n\n                    return {\n                        name: endpoint,\n                        description:\n                            operation.summary ||\n                            `Endpoint that handles ${method.toUpperCase()} requests to ${endpoint}. ` + `${schema?.description || ''}`,\n                        inputSchema: {\n                            type: 'object',\n                            properties: properties,\n                            required: schema?.required || [],\n                        },\n                    };\n                });\n\n                // Tool handlers\n                server.setRequestHandler(ListToolsRequestSchema, async () => ({\n                    tools,\n                }));\n\n                server.setRequestHandler(CallToolRequestSchema, async (request) => {\n                    try {\n                        const { name, arguments: args } = request.params;\n\n                        if (!args) {\n                            throw new Error('No arguments provided');\n                        }\n\n                        // Find the matching tool from our tools array\n                        const tool = tools.find((t) => t.name === name);\n                        if (!tool) {\n                            return {\n                                content: [{ type: 'text', text: `Unknown tool: ${name}` }],\n                                isError: true,\n                            };\n                        }\n\n                        try {\n                            // Extract method and path from OpenAPI spec\n                            const pathEntry = Object.entries(openAPISpec.paths).find(([path]) => path.split('/api/')[1] === name);\n                            if (!pathEntry) {\n                                throw new Error(`Could not find path for tool: ${name}`);\n                            }\n\n                            const [path, methods] = pathEntry;\n                            const method = Object.keys(methods)[0];\n\n                            // Process the request through the agent\n                            const result = await AgentProcess.load(agentData).run({\n                                method: method,\n                                path: path,\n                                body: args,\n                            });\n\n                            return {\n                                content: [{ type: 'text', text: JSON.stringify(result) }],\n                                isError: false,\n                            };\n                        } catch (error) {\n                            return {\n                                content: [{ type: 'text', text: `Error processing request: ${error.message}` }],\n                                isError: true,\n                            };\n                        }\n                    } catch (error) {\n                        return {\n                            content: [\n                                {\n                                    type: 'text',\n                                    text: `Error: ${error instanceof Error ? error.message : String(error)}`,\n                                },\n                            ],\n                            isError: true,\n                        };\n                    }\n                });\n\n                const transport = new SSEServerTransport('/emb/mcp/message', res);\n                await server.connect(transport);\n\n                clientTransports.set(transport.sessionId, { transport, server });\n                console.log('Generated sessionId', transport.sessionId);\n                console.log('MCP Server running on sse');\n            } catch (error: unknown) {\n                console.error(error);\n                return res.status(500).send({ error: (error as Error).message });\n            }\n        });\n\n        router.post('/message', async (req: express.Request, res: express.Response) => {\n            const sessionId = req.query.sessionId;\n            console.log('Received sessionId', sessionId);\n            const transport = clientTransports.get(sessionId as string)?.transport;\n            if (!transport) {\n                return res.status(404).send({ error: 'Transport not found' });\n            }\n            await transport.handlePostMessage(req, res, req.body);\n        });\n    }\n}\n","import crypto from 'crypto';\nimport { Readable } from 'stream';\n\nimport { faker } from '@faker-js/faker';\nimport { OpenAI } from 'openai';\n\nimport { AccessCandidate, ConnectorService, Conversation, Logger } from '@smythos/sdk/core';\n\nimport APIError from '@/APIError.class';\nimport { getAgentIdAndVersion } from '@/utils/agent.utils';\n\nconst console = Logger('Service: Chat');\n\ninterface ChatCompletionParams {\n    apiKey: string;\n    modelId: string;\n    params: OpenAI.Chat.Completions.ChatCompletionCreateParamsNonStreaming;\n    options?: {\n        include_status?: boolean;\n    };\n}\n\nclass OpenAIChatService {\n    async chatCompletion({\n        apiKey,\n        modelId,\n        params,\n        options,\n    }: ChatCompletionParams): Promise<OpenAI.Chat.Completions.ChatCompletion | Readable | APIError> {\n        const { agentId, agentVersion } = getAgentIdAndVersion(params.model);\n        console.log('parsed agentId and agentVersion', agentId, agentVersion);\n\n        if (!apiKey) {\n            return new APIError(401, 'Invalid Authentication', 'Unauthorized');\n        }\n\n        // TODO: move this to the agent loader middleware\n        const accessCandidate = AccessCandidate.agent(agentId);\n        const vaultConnector = ConnectorService.getVaultConnector();\n        const exists = await vaultConnector\n            .user(accessCandidate)\n            .exists(apiKey)\n            .catch((error) => {\n                console.error('Error checking if api key exists:', error);\n                return false;\n            });\n\n        if (!exists) {\n            return new APIError(401, 'Incorrect API key provided', 'Unauthorized');\n        }\n\n        const systemPrompt = params.messages\n            .filter((m) => m.role === 'system')\n            .map((m) => m.content)\n            .join('\\n');\n\n        const conv = new Conversation(modelId, agentId, { agentVersion });\n        await conv.ready;\n        if (systemPrompt.trim()?.length) {\n            conv.systemPrompt += `\\n\\n######\\n\\n${systemPrompt}`;\n        }\n\n        const history = params.messages.filter((m) => m.role !== 'system');\n        const lastUserMessageIndx = history.length - 1 - [...history].reverse().findIndex((m) => m.role === 'user');\n        // remove the last user message from the history\n        const lastUserMessage = history.splice(lastUserMessageIndx, 1)[0];\n\n        for (const message of history) {\n            const id = crypto.randomUUID();\n            switch (message.role) {\n                case 'user':\n                    conv.context.addUserMessage(message.content as string, id);\n                    break;\n                case 'assistant':\n                    conv.context.addAssistantMessage(message.content as string, id);\n                    break;\n            }\n        }\n\n        const completionId = `chatcmpl-${crypto.randomUUID()}`;\n\n        if (params.stream) {\n            const readable = new Readable({\n                read() {},\n            });\n\n            conv.on('content', (content) => {\n                const now = Date.now();\n                const preparedContent: OpenAI.Chat.Completions.ChatCompletionChunk = {\n                    id: completionId,\n                    object: 'chat.completion.chunk',\n                    created: now,\n                    model: params.model,\n                    choices: [{ index: 0, delta: { content }, finish_reason: null }],\n                };\n                // options?.include_status && this.randomlyEmitStatus(readable, completionId, now, params); // for PoC\n                readable.push(`data: ${JSON.stringify(preparedContent)}\\n\\n`);\n            });\n\n            //Removed : passthrough content is now returned as normal content in the content event\n            // conv.on('agentCallback', (content) => {\n            //     const now = Date.now();\n            //     const preparedContent: OpenAI.Chat.Completions.ChatCompletionChunk = {\n            //         id: completionId,\n            //         object: 'chat.completion.chunk',\n            //         created: now,\n            //         model: params.model,\n            //         choices: [{ index: 0, delta: { content }, finish_reason: null }],\n            //     };\n            //     // options?.include_status && this.randomlyEmitStatus(readable, completionId, now, params); // for PoC\n            //     readable.push(`data: ${JSON.stringify(preparedContent)}\\n\\n`);\n            // });\n\n            conv.on('beforeToolCall', (info) => {\n                const now = Date.now();\n                console.log('Before Tool Call:', info);\n                // tool name info?.tool?.name\n                if (!options?.include_status) return;\n\n                const toolStatusChunk: OpenAI.Chat.Completions.ChatCompletionChunk & {\n                    choices: { index: number; delta: { content: string; status: string }; finish_reason: string | null }[];\n                } = {\n                    id: completionId,\n                    object: 'chat.completion.chunk',\n                    created: now,\n                    model: params.model,\n                    choices: [\n                        {\n                            finish_reason: null,\n                            index: 0,\n                            delta: {\n                                content: '',\n                                status: info?.tool?.name,\n                            },\n                        },\n                    ],\n                };\n                readable.push(`data: ${JSON.stringify(toolStatusChunk)}\\n\\n`);\n            });\n\n            conv.on('toolCall', (info) => {\n                const now = Date.now();\n                console.debug('Tool Call:', info);\n                const toolStatusChunk: OpenAI.Chat.Completions.ChatCompletionChunk & {\n                    choices: { index: number; delta: { content: string }; finish_reason: string | null }[];\n                } = {\n                    id: completionId,\n                    object: 'chat.completion.chunk',\n                    created: now,\n                    model: params.model,\n                    choices: [\n                        {\n                            finish_reason: null,\n                            index: 0,\n                            delta: {\n                                smyth_event: {\n                                    type: 'toolCall',\n                                    content: info?.tool?.name,\n                                },\n                                content: '',\n                            },\n                        },\n                    ],\n                };\n                readable.push(`data: ${JSON.stringify(toolStatusChunk)}\\n\\n`);\n            });\n\n            conv.on('usage', (usage) => {\n                const now = Date.now();\n                console.debug('Usage:', usage);\n                // tool name info?.tool?.name\n                // if (!options?.include_status) return;\n\n                const toolStatusChunk: OpenAI.Chat.Completions.ChatCompletionChunk & {\n                    choices: { index: number; delta: { content: string }; finish_reason: string | null }[];\n                } = {\n                    id: completionId,\n                    object: 'chat.completion.chunk',\n                    created: now,\n                    model: params.model,\n                    choices: [\n                        {\n                            finish_reason: null,\n                            index: 0,\n                            delta: {\n                                smyth_event: {\n                                    type: 'usage',\n                                    content: usage,\n                                },\n                                content: '',\n                            },\n                        },\n                    ],\n                };\n                readable.push(`data: ${JSON.stringify(toolStatusChunk)}\\n\\n`);\n            });\n\n            conv.on('end', () => {\n                console.log('streaming: [DONE]');\n                readable.push('data: [DONE]\\n\\n');\n                readable.push(null);\n            });\n\n            conv.on('error', (error) => {\n                console.info('streaming: error', error);\n                readable.emit('error', error);\n            });\n\n            conv.streamPrompt(lastUserMessage?.content as string, {\n                'X-AGENT-ID': agentId,\n            }).catch((error) => {\n                readable.emit('error', error);\n            });\n\n            return readable;\n        } else {\n            const now = Date.now();\n            const result = (await conv.prompt(lastUserMessage?.content as string, {\n                'X-AGENT-ID': agentId,\n            })) as string;\n\n            return {\n                id: completionId,\n                object: 'chat.completion',\n                created: now,\n                model: params.model,\n                choices: [\n                    { index: 0, message: { role: 'assistant', content: result, refusal: null }, logprobs: null, finish_reason: 'stop' },\n                ],\n            };\n        }\n    }\n\n    private firstTime = true;\n    private randomlyEmitStatus(\n        readable: Readable,\n        completionId: string,\n        now: number,\n        params: OpenAI.Chat.Completions.ChatCompletionCreateParamsNonStreaming,\n    ) {\n        const shouldEmitStatus = this.firstTime || Math.random() < 0.5;\n        if (this.firstTime) {\n            this.firstTime = false;\n        }\n\n        const randomToolStatus = [\n            { text: 'Thinking', pauseDelay: 5_000 },\n            { text: 'Analyzing', pauseDelay: 5_000 },\n        ];\n        if (shouldEmitStatus) {\n            const status = randomToolStatus.pop();\n            if (!status) return;\n            const statusChunk: OpenAI.Chat.Completions.ChatCompletionChunk & {\n                choices: { index: number; delta: { content: string; status: string }; finish_reason: string | null }[];\n            } = {\n                id: completionId,\n                object: 'chat.completion.chunk',\n                created: now,\n                model: params.model,\n                choices: [{ index: 0, delta: { content: '', status: status.text }, finish_reason: null }],\n                system_fingerprint: undefined,\n            };\n            readable.push(`data: ${JSON.stringify(statusChunk)}\\n\\n`);\n            readable.pause();\n            setTimeout(() => {\n                readable.resume();\n            }, status.pauseDelay);\n        }\n    }\n\n    private fakeStream() {\n        // just fake a stream with dummy data\n        const readable = new Readable({\n            read() {},\n        });\n\n        const sentences = faker.lorem.sentences(10);\n\n        for (const sentence of sentences) {\n            const preparedContent: OpenAI.Chat.Completions.ChatCompletionChunk = {\n                id: crypto.randomUUID(),\n                object: 'chat.completion.chunk',\n                created: Date.now(),\n                model: 'gpt-4o-mini',\n                choices: [{ index: 0, delta: { content: sentence }, finish_reason: null }],\n                system_fingerprint: undefined,\n            };\n            readable.push(`data: ${JSON.stringify(preparedContent)}\\n\\n`);\n        }\n\n        readable.push('data: [DONE]\\n\\n');\n        readable.push(null);\n        return readable;\n    }\n}\n\nexport const chatService = new OpenAIChatService();\n","import Joi from 'joi';\n\nexport const chatValidations = {\n    chatCompletion: {\n        headers: Joi.object({\n            authorization: Joi.string().required(),\n        }).required(),\n        query: Joi.object({\n            include_status: Joi.boolean().optional(),\n        }),\n        body: Joi.object({\n            messages: Joi.array()\n                .items(\n                    Joi.object({\n                        role: Joi.string().valid('system', 'user', 'assistant').required(),\n                        content: Joi.string().allow(null).required(),\n                    }),\n                )\n                .required(),\n            model: Joi.string().required(),\n            stream: Joi.boolean().optional(),\n        }).required(),\n    },\n};\n","import { getAgentIdAndVersion } from '@/utils/agent.utils';\n\nexport default async function AgentDataAdapter(req, res, next) {\n    const agentFromModel: any = req.body.model ? getAgentIdAndVersion(req.body.model) : {};\n\n    //populate agent id and version headers if not present and LLM data provided\n    req.headers['x-agent-id'] = req.header('x-agent-id') || agentFromModel.agentId;\n    req.headers['x-agent-version'] = req.header('x-agent-version') || agentFromModel.version || '';\n\n    next();\n}\n","import { NextFunction } from 'express';\nimport Joi, { ObjectSchema, Schema } from 'joi';\n\nimport ApiError from '@/APIError.class';\n\ntype AnyObject = {\n    [x: string]: any;\n};\n\nconst pick = (object: AnyObject, keys: string[]) =>\n    keys.reduce((newObject: AnyObject, key) => {\n        if (object && Object.prototype.hasOwnProperty.call(object, key)) {\n            newObject[key] = object[key];\n        }\n        return newObject;\n    }, {});\n\ntype SchemaObject = {\n    body?: ObjectSchema<any> | Schema;\n    query?: ObjectSchema<any> | Schema;\n    params?: ObjectSchema<any> | Schema;\n};\n\nconst validate = (schema: SchemaObject) => (req: any, _res: any, next: NextFunction) => {\n    const validSchema = pick(schema, ['params', 'query', 'body']);\n    const object = pick(req, Object.keys(validSchema));\n    const { value, error } = Joi.compile(validSchema)\n        .prefs({ errors: { label: 'key' }, abortEarly: false })\n        .validate(object);\n\n    if (error) {\n        const errorMessage = error.details.map((details) => details.message).join(', ');\n        return next(new ApiError(400, errorMessage));\n    }\n    Object.assign(req, value);\n    return next();\n};\n\nexport { validate };\n","import { OpenAI } from 'openai';\n\n/**\n * Extracts a Bearer token from the Authorization header\n * @param authHeader - The Authorization header value\n * @returns The extracted token or null if the token is invalid\n */\nexport function extractBearerToken(authHeader: string | undefined): string | null {\n    if (!authHeader) {\n        return null;\n    }\n\n    if (typeof authHeader !== 'string' || !authHeader.startsWith('Bearer ')) {\n        return null;\n    }\n\n    const token = authHeader.slice(7).trim();\n\n    if (!token?.length) {\n        return null;\n    }\n\n    return token;\n}\n\nexport function createOpenAIError(statusCode: number, error: any) {\n    return new OpenAI.APIError(\n        statusCode,\n        {\n            code: error?.errKey || error?.code,\n            message: error?.message,\n            type: error?.name,\n        },\n        error?.message,\n        null,\n    );\n}\n","import { Readable } from 'stream';\n\nimport express from 'express';\n\nimport APIError from '@/APIError.class';\nimport { DEFAULT_AGENT_MODEL, DEFAULT_AGENT_MODEL_SETTINGS_KEY } from '@/constants';\nimport AgentLoader from '@/middlewares/AgentLoader.mw';\nimport { BaseRole } from '@/roles/Base.role';\nimport { chatService } from '@/roles/openai/Chat.service';\nimport type { ModelResolver } from '@/types/resolvers.types';\n\nimport { chatValidations } from './chat.validation';\nimport AgentDataAdapter from './middlewares/AgentDataAdapter.mw';\nimport { validate } from './middlewares/Validate.mw';\nimport { createOpenAIError, extractBearerToken } from './utils';\n\nexport class OpenAIRole extends BaseRole {\n    /**\n     * Creates a new OpenAIRole instance.\n     * @param middlewares - Additional middlewares to apply after AgentDataAdapter and AgentLoader\n     * @param options - Configuration options for the role\n     * @param options.model - Optional model override: string for static model, or function to resolve model dynamically\n     */\n    constructor(middlewares: express.RequestHandler[] = [], options: { model?: ModelResolver } = {}) {\n        super(middlewares, options);\n    }\n\n    public async mount(router: express.Router) {\n        const middlewares = [AgentDataAdapter, AgentLoader, ...this.middlewares];\n\n        router.post(\n            '/v1/chat/completions',\n            middlewares,\n            validate(chatValidations.chatCompletion),\n            async (req: express.Request, res: express.Response) => {\n                try {\n                    const agentData = (req as any)._agentData;\n                    const agentSettings = (req as any)._agentSettings;\n\n                    // Wait for agent settings to be ready\n                    await agentSettings?.ready();\n\n                    // Get base model from agent settings or use system default\n                    const baseModel = agentSettings?.get(DEFAULT_AGENT_MODEL_SETTINGS_KEY) || DEFAULT_AGENT_MODEL;\n\n                    // Apply model resolution strategy: static string, dynamic function, or default to base model\n                    const model = this.resolve(\n                        this.options?.model,\n                        { baseModel, planInfo: agentData?.planInfo || {} },\n                        baseModel,\n                    );\n\n                    const authHeader = req.headers['authorization'];\n                    const apiKey = extractBearerToken(authHeader);\n\n                    const result = await chatService.chatCompletion({\n                        apiKey,\n                        modelId: model,\n                        params: req.body,\n                        options: req.query,\n                    });\n\n                    if (result instanceof APIError) {\n                        const error = createOpenAIError(result.statusCode, result);\n                        return res.status(result.statusCode).json(error);\n                    }\n\n                    if (result instanceof Readable) {\n                        // Handle streaming response: set headers for Server-Sent Events (SSE)\n                        res.setHeader('Content-Type', 'text/event-stream');\n                        res.setHeader('Cache-Control', 'no-cache');\n                        res.setHeader('Connection', 'keep-alive');\n\n                        result.on('error', (error: any) => {\n                            console.warn('Chat completion streaming error:', error);\n                            const status = error?.status || 500;\n                            const apiError = createOpenAIError(status, error);\n                            res.status(status).json(apiError);\n                        });\n\n                        // Pipe the stream to response\n                        result.pipe(res);\n                    } else {\n                        // Handle non-streaming response\n                        res.json(result);\n                    }\n                } catch (error) {\n                    // Handle any unexpected errors\n                    console.warn('Chat completion error:', error);\n                    const status = error?.status || 500;\n                    const apiError = createOpenAIError(status, error);\n                    return res.status(status).json(apiError);\n                }\n            },\n        );\n    }\n}\n","import express from 'express';\n\nimport { ConnectorService } from '@smythos/sdk/core';\n\nimport AgentLoader from '@/middlewares/AgentLoader.mw';\nimport { BaseRole } from '@/roles/Base.role';\n\nexport class OpenAPIRole extends BaseRole {\n    /**\n     * Creates a new OpenAPIRole instance.\n     * @param middlewares - The custom middlewares to apply to the role on top of the default middlewares.\n     * @param options - The options for the role. Defaults to an empty object.\n     */\n    constructor(middlewares: express.RequestHandler[] = [], options: Record<string, unknown> = {}) {\n        super(middlewares, options);\n    }\n\n    public async mount(router: express.Router) {\n        const middlewares = [AgentLoader, ...this.middlewares];\n\n        router.get('/api-docs/openapi.json', middlewares, openapiJSONHandler);\n        router.get('/api-docs/openapi-llm.json', middlewares, openapiJSON4LLMHandler);\n    }\n}\n\nasync function openapiJSONHandler(req: express.Request, res: express.Response) {\n    const domain = req.hostname;\n    const agentData = req._agentData;\n\n    const agentDataConnector = ConnectorService.getAgentDataConnector();\n    const openAPIObj = await agentDataConnector.getOpenAPIJSON(agentData, domain, req._agentVersion, false).catch((error) => {\n        console.error(error);\n        return { error: error.message };\n    });\n\n    if (openAPIObj?.error) {\n        return res.status(500).send({ error: openAPIObj.error });\n    }\n    // set application type to json\n    res.setHeader('Content-Type', 'application/json');\n    res.send(JSON.stringify(openAPIObj, null, 2));\n}\n\nasync function openapiJSON4LLMHandler(req: express.Request, res: express.Response) {\n    const domain = req.hostname;\n    const agentData = req._agentData;\n\n    const agentDataConnector = ConnectorService.getAgentDataConnector();\n    const openAPIObj = await agentDataConnector.getOpenAPIJSON(agentData, domain, req._agentVersion, true).catch((error) => {\n        console.error(error);\n        return { error: error.message };\n    });\n\n    if (openAPIObj?.error) {\n        return res.status(500).send({ error: openAPIObj.error });\n    }\n    // set application type to json\n    res.setHeader('Content-Type', 'application/json');\n    res.send(JSON.stringify(openAPIObj, null, 2));\n}\n","import express from 'express';\nimport Converter from 'openapi-to-postmanv2';\n\nimport { ConnectorService } from '@smythos/sdk/core';\n\nimport AgentLoader from '@/middlewares/AgentLoader.mw';\nimport { BaseRole } from '@/roles/Base.role';\n\ninterface PostmanConversionResult {\n    result: boolean;\n    reason?: string;\n    output?: Array<{ data: unknown }>;\n}\n\nexport class PostmanRole extends BaseRole {\n    /**\n     * Creates a new PostmanRole instance.\n     * @param middlewares - Custom middlewares to apply to the role on top of the default middlewares.\n     * @param options - Configuration options for the role.\n     * @param options.serverOrigin - The server origin URL. Can be a string or a function that accepts the request and returns a string.\n     *                                Used to generate the correct base URL in the OpenAPI spec before conversion.\n     *                                Defaults to an empty string.\n     */\n    constructor(middlewares: express.RequestHandler[], options: { serverOrigin: string | ((req: express.Request) => string) }) {\n        super(middlewares, options);\n    }\n\n    /**\n     * Mounts the Postman collection endpoint on the provided router.\n     *\n     * Creates a GET route that:\n     * 1. Loads agent data via AgentLoader middleware\n     * 2. Fetches the agent's OpenAPI specification\n     * 3. Converts the OpenAPI spec to Postman collection format using openapi-to-postmanv2\n     * 4. Returns the Postman collection as a downloadable JSON file\n     *\n     * @param router - The Express router to mount the endpoint on.\n     * @throws Returns 500 error if OpenAPI spec retrieval or conversion fails.\n     */\n    public async mount(router: express.Router) {\n        const middlewares = [AgentLoader, ...this.middlewares];\n\n        router.get('/', middlewares, async (req: express.Request, res: express.Response) => {\n            const agentData = req._agentData;\n            try {\n                const serverOrigin = this.resolve(this.options.serverOrigin, req);\n\n                const agentDataConnector = ConnectorService.getAgentDataConnector();\n                const openAPISpec = await agentDataConnector\n                    .getOpenAPIJSON(agentData, serverOrigin, agentData.version, false)\n                    .catch((error) => {\n                        console.error(error);\n                        return { error: error.message };\n                    });\n\n                if (openAPISpec?.error) {\n                    return res.status(500).send({ error: openAPISpec.error });\n                }\n\n                const conversionResult: PostmanConversionResult = await new Promise((resolve, reject) => {\n                    Converter.convert({ type: 'json', data: openAPISpec }, {}, (err, result) => {\n                        if (err) {\n                            reject(err);\n                        } else if (result.result) {\n                            resolve(result);\n                        } else {\n                            reject(new Error(`Conversion failed: ${result.reason}`));\n                        }\n                    });\n                });\n\n                // Force download the generated Postman collection\n                const filename = `${agentData.name}.postman.json`; // Specify the filename here\n                res.setHeader('Content-Disposition', `attachment; filename=\"${filename}\"`);\n                res.setHeader('Content-Type', 'application/json');\n                res.send(JSON.stringify(conversionResult?.output?.[0]?.data, null, 2));\n            } catch (error: unknown) {\n                console.error(error);\n                return res.status(500).send({ error: (error as Error).message });\n            }\n        });\n    }\n}\n","import express from 'express';\nimport swaggerUi from 'swagger-ui-express';\n\nimport { ConnectorService } from '@smythos/sdk/core';\n\nimport AgentLoader from '@/middlewares/AgentLoader.mw';\nimport { BaseRole } from '@/roles/Base.role';\n\nexport class SwaggerRole extends BaseRole {\n    /**\n     * Creates a new SwaggerRole instance.\n     * @param router - The router to mount the role on.\n     * @param middlewares - The custom middlewares to apply to the role on top of the default middlewares.\n     * @param options - The options for the role.\n     * Accepts:\n     * - staticPath: The path to the static files for the role. this assumes that a static route is mounted and the swagger files (swagger.js, swagger-debug.js) are served from this path.\n     * Defaults to '/static/embodiment/swagger'.\n     */\n    constructor(\n        middlewares: express.RequestHandler[],\n        options: { serverOrigin: string | ((req: express.Request) => string); staticPath?: string },\n    ) {\n        super(middlewares, {\n            staticPath: '/static/embodiment/swagger',\n            ...options,\n        });\n    }\n    public async mount(router: express.Router) {\n        const middlewares = [AgentLoader, ...this.middlewares];\n        router.use('/', swaggerUi.serve);\n        router.use('/', middlewares, async (req: any, res) => {\n            //TODO : handle release switch : dev, prod, prod old versions [DONE]\n            const agentData = (req as any)._agentData;\n            // const debugSessionEnabled = agent.debugSessionEnabled;\n            const isTestDomain = agentData.usingTestDomain;\n            //const openApiDocument = await getOpenAPIJSON(agentData, domain, req._agentVersion, false);\n\n            const serverOrigin = this.resolve(this.options.serverOrigin, req);\n\n            const agentDataConnector = ConnectorService.getAgentDataConnector();\n            const openApiDocument = await agentDataConnector.getOpenAPIJSON(agentData, serverOrigin, agentData.version, false);\n\n            if (agentData?.auth?.method && agentData?.auth?.method != 'none') {\n                // Add or update security definitions\n                openApiDocument.components = openApiDocument.components || {};\n                openApiDocument.components.securitySchemes = {\n                    ApiKeyAuth: {\n                        type: 'apiKey',\n                        in: 'header',\n                        name: 'Authorization',\n                    },\n                };\n                openApiDocument.security = [{ ApiKeyAuth: [] }];\n            }\n\n            let htmlContent = swaggerUi.generateHTML(openApiDocument);\n\n            let debugScript = `<script src=\"${this.options.staticPath}/swagger.js\"></script>`;\n            if (isTestDomain) {\n                debugScript += `\n<script src=\"${this.options.staticPath}/swagger-debug.js\"></script>\n<script>\ninitDebug('${process.env.UI_SERVER}', '${agentData.id}');\n</script>\n`;\n            }\n\n            //inject the debug script before closing body tag\n            htmlContent = htmlContent.replace('</body>', `${debugScript}</body>`);\n            res.send(htmlContent);\n        });\n    }\n}\n"],"names":["__publicField","console","dbgPromise","cors","schema","McpServer","path","APIError"],"mappings":"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"}